<!DOCTYPE html>
<html>
<meta charset="utf-8">

<head>
<title>Urlaubsverwaltung</title>

<link rel="stylesheet" href="lib/ionicons/css/ionicons.min.css" />
<link rel='stylesheet' href='lib/fullcalendar/fullcalendar.css' />
<link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css" />

<script type="text/javascript" src="lib/jquery/jquery-1.11.1.min.js"></script>
<script src="lib/bootstrap/js/bootstrap.min.js"></script>
<script src="lib/fullcalendar/lib/moment.min.js"></script>
<script src="lib/fullcalendar/fullcalendar.js"></script>

<script src="js/client.js"></script>
<script src="js/model.js"></script>

<script type="text/javascript">
	var calendar;
	
	function array_unique(arrayName) {					//entfernt doppelte array einträge.
	var newArray = new Array();
	label:for(var i=0; i<arrayName.length;i++ ) {  
		for(var j=0; j<newArray.length;j++ ) {
		        if(newArray[j] == arrayName[i]) 
				continue label;
			}
		        newArray[newArray.length] = arrayName[i];
		}
		return newArray;
	}

	function departmentMenu(){							//füllt das Abteilungsmenü mit Abteiulungen.
	var persons = getPersons();
	var dep = new Array;
	var dep_new = new Array;
	var rows = "";
		for(var i=0; i<persons.length; i++){
			var person = persons[i];
			dep[i] = person.department;	
		}
		dep_new = array_unique(dep);
		console.log(dep_new);
		
		for (var i=0; i<dep_new.length; i++){
		rows += "<a role='menuitem' tabindex='-1' href='#'>"+dep_new[i]+"</a></li>";
		
		$("#department_menu").html(rows);
		}
	}
	
	function getFilteredHolidayRequests(filters) {
		var requests = getHolidayRequests();
		//filter
		return requests;
	}

	function getActualFilters() {
		return [];
	}

	function unixTS2calendarTS(timestamp) {
		var date = new Date(timestamp * 1000);
		return date.getFullYear() + "-" + (date.getMonth() + 1) + "-"
				+ date.getDate();
	}

	function getCalendarEvents() {
		var events = [];
		var requests = getFilteredHolidayRequests(getActualFilters());

		for (var i = 0; i < requests.length; i++) {
			var request = requests[i];
			var person = getPerson(request.person);
			var title = person.forename + " " + person.lastname;
			var start = unixTS2calendarTS(request.start);
			var end = unixTS2calendarTS(request.end);
			console.log(start);
			events.push({
				title : title,
				start : start,
				end : end
			});
		}

		return events;

	}

	$(document).ready(function() {

		departmentMenu();
		
		calendar = $('#calendar').fullCalendar({
			lang : 'de', 

			header : {
				left : 'prev,next',
				center : 'title',
				right : 'year,month,agendaWeek'
			},
			defaultView : 'year',
			//weekends: false,
			firstDay : 0,

			events : getCalendarEvents()

		});

	});
</script>
</head>

<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<span class="navbar-brand">Urlaubsverwaltung</span>
			</div>
			<div>
				<ul class="nav navbar-nav">
					<li class="active"><a href="#"><span class="ion-home">Übersicht</a></li>
					<li><a href="my.html"><span class="ion-person"></span>
							Mein Kalender</a></li>
					<li><a href="requests.html"><span class="ion-clipboard">Anfragen</a></li>
					<li><a href="admin.php"><span class="ion-clipboard">Admin</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container">
		<div class="row">
			<div class="dropdown">
				<button class="btn btn-default dropdown-toggle" type="button"
					id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
					Abteilungen <span class="caret"></span>
				</button>
				<ul class="dropdown-menu" role="menu"
					aria-labelledby="dropdownMenu1">
					<li id ="department_menu"role="presentation"><a role="menuitem" tabindex="-1"
						href="#">Abt1</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">

			<div class="panel panel-default">
				<div class="panel-heading">Kalender</div>
				<div class="panel-body">
					<div id='calendar'></div>
				</div>
			</div>
		</div>
	</div>


</body>

</html>
